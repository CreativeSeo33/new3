<div class="relative inline-block group"
     data-controller="cart-counter cart-dropdown"
     data-cart-counter-count-value="{{ count }}"
     data-cart-counter-total-value="{{ total }}"
     data-cart-counter-currency-value="{{ currency }}"
     data-cart-counter-url-value="{{ path('api_cart_get') }}"
     data-action="
       cart:updated@window->cart-counter#onExternalUpdate
       storage@window->cart-counter#onStorageEvent
       pointerenter->cart-dropdown#enter
       pointerleave->cart-dropdown#leave
       focusin->cart-dropdown#focusIn
       focusout->cart-dropdown#focusOut
       keydown@window->cart-dropdown#onKeydown
       click@document->cart-dropdown#onDocumentClick
     ">
  <a href="{{ path('cart_page') }}" class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-50 transition-colors" data-cart-dropdown-target="trigger" aria-expanded="false" aria-controls="cart-dropdown-panel">
    <div class="relative">
      <svg class="w-6 h-6 text-gray-600 group-hover:text-blue-600 transition-colors" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007ZM8.625 10.5a .375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm7.5 0a .375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"/>
      </svg>
      <span data-cart-counter-target="badge"
            data-cart-counter
            class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium">
        {{ count }}
      </span>
    </div>
    <span class="ml-2 text-sm text-gray-700 group-hover:text-blue-700 transition-colors"
          data-cart-counter-target="total">
      {{ total|number_format(0, '.', ' ') }} руб.
    </span>
  </a>

  <div id="cart-dropdown-panel" class="absolute right-0 top-full mt-2 w-80 bg-white border border-gray-200 rounded-lg shadow-lg z-[60] opacity-0 invisible pointer-events-none transition-opacity"
       data-cart-dropdown-target="dropdown" role="dialog" aria-hidden="true">
    {{ include('components/spinner.html.twig', {
      id: 'cart-counter-spinner',
      visible: false,
      overlay: true,
      size: 'medium'
    }) }}
    <div class="p-3 max-h-96 min-h-24 overflow-auto" data-cart-counter-target="list"></div>
    <div class="border-t p-3 text-sm text-gray-700 space-y-1">
      <div class="flex justify-between">
        <span>Доставка</span>
        <span data-cart-counter-target="shipping"></span>
      </div>
      <div class="flex justify-between">
        <span>Итого</span>
        <span data-cart-counter-target="dropdownTotal">{{ total|number_format(0, '.', ' ') }} руб.</span>
      </div>
    </div>

    <div class="border-t p-3 flex items-center justify-between gap-2">
      <a href="{{ path('cart_page') }}"
         class="px-3 py-2 text-sm rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50">
        Перейти в корзину
      </a>
      <a href="{{ path('checkout_page') }}"
         class="px-3 py-2 text-sm rounded-md bg-black text-white hover:bg-gray-900">
        Оформить заказ
      </a>
    </div>
  </div>
</div>