{% extends 'base.html.twig' %}

{% block title %}Catalog — {{ parent() }}{% endblock %}

{% block styles %}
  {{ parent() }}
  {{ encore_entry_link_tags('catalog') }}
{% endblock %}

{% block body %}
  {% include 'catalog/layouts/header.html.twig' %}
  {% include 'catalog/layouts/navbar.html.twig' %}
  {% include 'catalog/layouts/breadcrumbs.html.twig' %}

  {% block catalog_body %}{% endblock %}

  {% if app.request.get('_route') == 'catalog_index' %}
    <div id="catalog-app"></div>
  {% endif %}

  {% include 'catalog/layouts/footer.html.twig' %}
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  {{ encore_entry_script_tags('catalog') }}

  {# Мини-обновление счётчика корзины в хедере по событию cart:updated #}
  <script>
  // Легаси код для совместимости - может быть удален после полной миграции
  window.addEventListener('cart:updated', (e) => {
    try {
      const data = e.detail;
      const count = (data.items || []).length;
      const total = (data.total || 0) / 100;
      const counter = document.querySelector('[data-cart-counter]');
      const totalEl = document.querySelector('[data-cart-total]');
      const label = document.querySelector('[data-cart-label]');
      if (counter) counter.textContent = String(count);
      if (totalEl) totalEl.textContent = new Intl.NumberFormat('ru-RU', { style: 'currency', currency: (data.currency || 'RUB') }).format(total);
      if (label) label.textContent = `${count} товар(ов)`;
    } catch {}
  });
  </script>
{% endblock %}


