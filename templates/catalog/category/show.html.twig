{% extends 'catalog/base.html.twig' %}

{% block title %}Категория {{ category.name ?? category.slug }} — {{ parent() }}{% endblock %}

{% block catalog_body %}
  <section>
    <div class="container mx-auto py-3">
      <h1 class="flex items-center gap-3 pb-6 mb-2 border-b border-gray-200">
        <span>{{ category.name ?? category.slug }}</span>
        <span class="text-sm font-normal text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
          {{ total|default(0) }} {{ total|default(0) == 1 ? 'товар' : (total|default(0) > 1 and total|default(0) < 5 ? 'товара' : 'товаров') }}
        </span>
      </h1>
      {% if category.description %}
        <p>{{ category.description }}</p>
      {% endif %}

      <div
        class="grid grid-cols-1 md:grid-cols-4 gap-6"
        data-controller="facets"
        data-facets-category-id-value="{{ category.id }}"
        data-facets-products-url-value="{{ path('catalog_category_products', { slug: category.slug }) }}"
        data-facets-facets-url-value="{{ path('catalog_facets') }}?category={{ category.id }}"
      >
        <aside class="md:col-span-1">

        
        
          <div class="facets-panel">
            <div data-facets-target="list" data-initial-facets='{{ initial_facets_json|default("")|raw }}'></div>
          </div>

        </aside>
        <div class="md:col-span-3">
          <div class="mt-4 pb-6 border-b border-gray-200 hidden" data-facets-target="selected" aria-live="polite"></div>
          <div class="pb-6 pt-6 flex justify-normal items-center gap-2 border-b border-gray-200">
          
            <label for="limit-select" class="text-sm text-gray-600 align-left">Показывать по:</label>
            <select id="limit-select" class="select max-w-40 appearance-none align-left" aria-label="select" data-facets-target="limit" data-action="change->facets#onLimitChange">
              {% for l in allowedLimits|default([10,20,30]) %}
                <option value="{{ l }}" {% if (limit|default(20)) == l %}selected{% endif %}>{{ l }}</option>
              {% endfor %}
            </select>
            
            <div>
            <label for="sort-select" class="text-sm text-gray-600 ml-4">Сортировать:</label>
            {% set currentSort = app.request.query.get('sort')|default('popular') %}
            <select id="sort-select" class="select max-w-60 appearance-none" aria-label="select" data-facets-target="sort" data-action="change->facets#onSortChange">
              <option value="popular" {% if currentSort == 'popular' %}selected{% endif %}>По популярности</option>
              <option value="price_asc" {% if currentSort == 'price_asc' %}selected{% endif %}>Цена: по возрастанию</option>
              <option value="price_desc" {% if currentSort == 'price_desc' %}selected{% endif %}>Цена: по убыванию</option>
              <option value="date_desc" {% if currentSort == 'date_desc' %}selected{% endif %}>Новинки (сначала новые)</option>
              <option value="date_asc" {% if currentSort == 'date_asc' %}selected{% endif %}>Сначала старые</option>
              <option value="name_asc" {% if currentSort == 'name_asc' %}selected{% endif %}>Название: A→Z</option>
              <option value="name_desc" {% if currentSort == 'name_desc' %}selected{% endif %}>Название: Z→A</option>
            </select>
            </div>
          </div>
          <div class="relative" data-facets-target="products" data-action="click->facets#onPaginationClick">            
            <div id="category-grid-spinner" class="absolute inset-0 flex items-center justify-center z-10 hidden" data-size="small" data-color="secondary" data-overlay="true"></div>
            {% if products is defined and products is not empty %}
              {% include 'catalog/category/_grid.html.twig' with { products: products, total: total|default(0), page: page|default(1), limit: limit|default(20), slug: category.slug } %}
            {% else %}
              <p>Товаров нет.</p>
            {% endif %}
            
          </div>
        </div>
      </div>
    </div>
  </section>
  
{% endblock %}


