{# ai:component=delivery-selector map=@component_delivery-selector_map.mdc v=1 #}
{# ai:module=delivery-selector root="#delivery" #}
<div id="delivery" data-module="delivery-selector" data-testid="delivery-selector" class="p-4 border rounded mb-6">
  {% set _checkout = app.session.get('checkout') %}
  {% set _cityName = _checkout.delivery.city.cityName ?? null %}
  <div class="flex gap-2 items-end mb-3">
    <div class="flex items-center space-x-2 cursor-pointer" id="city-selector" data-city-modal-trigger data-module="city-modal-trigger" data-testid="city-modal-trigger">
      <svg class="w-5 h-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.951-7.5 11.951s-7.5-4.809-7.5-11.951a7.5 7.5 0 1 1 15 0Z"/>
      </svg>
      <span class="text-sm text-gray-800 font-medium">Ваш город: {{ _cityName ?? 'Не определен' }}</span>
    </div>
  </div>

  <section id="delivery-methods">
    <h3 class="text-sm font-medium mb-2">Способ доставки</h3>
    <div class="space-y-2 mb-3">
      <label class="flex items-center gap-2"><input type="radio" data-testid="delivery-method-pvz" name="deliveryMethod" value="pvz"> Пункт выдачи</label>
      <label class="flex items-center gap-2"><input type="radio" data-testid="delivery-method-courier" name="deliveryMethod" value="courier"> Курьер</label>
    </div>

    <div id="pvz-block" data-testid="delivery-pvz-block" class="mt-2 hidden">
      <div class="text-sm mb-2">Выберите пункт выдачи</div>
      <select id="pvz-select" data-testid="delivery-pvz-select" class="w-full border rounded px-3 py-2"></select>
      <div id="pvz-empty" data-testid="delivery-pvz-empty" class="text-sm text-gray-500 mt-2 hidden">В вашем городе пункты выдачи отсутствуют</div>
    </div>

    <div id="courier-block" data-testid="delivery-courier-block" class="mt-2 hidden">
      <label class="block text-sm mb-1">Адрес доставки</label>
      <input id="courier-address" data-testid="delivery-courier-address" class="w-full border rounded px-3 py-2" placeholder="Город, улица, дом, квартира" required />
      <div id="addr-error" data-testid="delivery-addr-error" class="text-xs text-red-600 mt-1 hidden">Адрес обязателен</div>
    </div>
  </section>

  <div class="text-sm mt-3">Стоимость доставки: <span id="ship-cost" data-testid="delivery-ship-cost">{{ (delivery.cost is defined and delivery.cost is not null) ? (delivery.cost / 100) : 0 }}</span> ₽</div>
</div>


