---
alwaysApply: true
description: Политика производительности агента (узкие поиски, маяки, лимиты)
globs:
  - assets/catalog/**
  - templates/catalog/**
---

# Политика производительности агента (Catalog/FSD)

Цель: ускорить работу агента за счёт узких областей поиска, AI‑маяков и стоп‑условий. Не сканировать монорепо целиком без крайней необходимости.

## Scope
- Каталог: `assets/catalog/**`, Twig каталога: `templates/catalog/**`.
- Исключить: `assets/admin/**`, `vendor/**`, `node_modules/**`, `public/**`, `public/build/**`, `var/**`.
- Приоритет FSD: см. `@catalog_js_architecture.mdc`.

## Маяки (anchor‑комментарии)
Используй их в первую очередь. Если маяк найден — не делать широких сканов.
- Реестр модулей: первая строка файла — `// ai:registry area=catalog key=data-module export=init root=@features`
- Бутстрап каталога (входная точка): первая строка — `// ai:bootstrap area=catalog uses=registry`
- HTTP‑клиент: первая строка — `// ai:http-client exports=<список>`
- Базовый компонент: первая строка — `// ai:base-component name=Component purpose=DOM/events`

## Константы путей (detected)
- REGISTRY_PATH: `assets/catalog/src/app/registry.ts`
- CATALOG_ENTRY: `assets/catalog/catalog.ts`
- SHARED_HTTP_PATH: `assets/catalog/src/shared/api/http.ts`
- SHARED_COMPONENT_PATH: `assets/catalog/src/shared/ui/Component.ts`
- TS_ALIAS_MAP (из `tsconfig.json` → `compilerOptions.paths`):
  - `@/*` → `assets/catalog/src/*`
  - `@shared/*` → `assets/catalog/src/shared/*`
  - `@features/*` → `assets/catalog/src/features/*`
  - `@entities/*` → `assets/catalog/src/entities/*`
  - `@widgets/*` → `assets/catalog/src/widgets/*`
  - `@pages/*` → `assets/catalog/src/pages/*`
  - `@admin/*` → `assets/admin/*`

## Порядок действий (быстрый)
1) Попробуй найти целевой файл по маяку (grep по `^// ai:` в ограниченных путях из Scope).
2) Если маяк отсутствует — делай узкий поиск:
   - Реестр: `assets/catalog/src/**` по токенам `registry`, `data-module`, `then(m => m.init)`.
   - Бутстрап/вход: `assets/catalog/**` по токенам `bootstrap`, `DOMContentLoaded`.
   - HTTP: `export function (get|post|patch|del)` или `requiresCsrfToken`.
   - Component: `export abstract class Component` или `@shared/ui/Component`.
3) Нашёл файл — останови широкие поиски и работай точечно.

## Лимиты и стоп‑условия
- max файлов в одном поиске: 200; max строк предпросмотра: 300.
- Остановиться, если:
  - найден маяк или точная сигнатура экспорта (`export const registry`, `export function get`, `export abstract class Component`).
  - найден `document.addEventListener('DOMContentLoaded'...)` в `assets/catalog/catalog.ts`.
- Повторные сканы делать только при изменении требований.

## Редактирование
- Вносить маяки только первыми строками файлов.
- Не менять бизнес‑логику.
- Соблюдать политику FSD: TypeScript, разделение API/UI, запрет inline `<script>` (см. `@catalog_js_architecture.mdc`).

## Связанные правила
- `@ai_context.mdc`
- `@catalog_js_architecture.mdc`
- `@stimulus_policy.mdc`

