---
alwaysApply: true
description: Политика производительности агента (узкие поиски, маяки, лимиты)
globs:
  - assets/catalog/**
  - templates/catalog/**
---

# Политика производительности агента (Catalog/FSD)

Цель: ускорить работу агента за счёт узких областей поиска, AI‑маяков и стоп‑условий. Не сканировать монорепо целиком без крайней необходимости.

## Scope
- Каталог: `assets/catalog/**`, Twig каталога: `templates/catalog/**`.
- Admin SPA: `assets/admin/**` (включать, если задача касается админки; приоритетно использовать маяки из `@ai_beacons_admin.mdc`).
- Исключить: `vendor/**`, `node_modules/**`, `public/**`, `public/build/**`, `var/**`.
- Приоритет FSD: см. `@catalog_js_architecture.mdc` и `@admin_js_architecture.mdc`.

## Маяки (anchor‑комментарии)
Используй их в первую очередь. Если маяк найден — не делать широких сканов.
- Catalog
  - Реестр модулей: первая строка файла — `// ai:registry area=catalog key=data-module export=init root=@features`
  - Бутстрап каталога (входная точка): первая строка — `// ai:bootstrap area=catalog uses=registry`
  - HTTP‑клиент: первая строка — `// ai:http-client exports=<список>`
  - Базовый компонент: первая строка — `// ai:base-component name=Component purpose=DOM/events`
- Admin SPA
  - Точка входа: `// ai:bootstrap area=admin uses=router,store`
  - Роутер: `// ai:router area=admin uses=auth,guards`
  - HTTP: `// ai:http-client area=admin exports=HttpClient,httpClient`
  - Store: `// ai:store area=admin name=auth exports=useAuthStore`

## Константы путей (detected)
- REGISTRY_PATH: `assets/catalog/src/app/registry.ts`
- CATALOG_ENTRY: `assets/catalog/catalog.ts`
- SHARED_HTTP_PATH: `assets/catalog/src/shared/api/http.ts`
- SHARED_COMPONENT_PATH: `assets/catalog/src/shared/ui/Component.ts`
- TS_ALIAS_MAP (из `tsconfig.json` → `compilerOptions.paths`):
  - `@/*` → `assets/catalog/src/*`
  - `@shared/*` → `assets/catalog/src/shared/*`
  - `@features/*` → `assets/catalog/src/features/*`
  - `@entities/*` → `assets/catalog/src/entities/*`
  - `@widgets/*` → `assets/catalog/src/widgets/*`
  - `@pages/*` → `assets/catalog/src/pages/*`
  - `@admin/*` → `assets/admin/*`

## Порядок действий (быстрый)
1) Попробуй найти целевой файл по маяку (grep по `^// ai:` в ограниченных путях из Scope).
2) Если маяк отсутствует — делай узкий поиск:
   - Catalog: как раньше (registry/bootstrap/http/component).
   - Admin: `assets/admin/**` по токенам `createRouter`, `createApp(App)`, `new Axios`, `interceptors`, `BaseRepository`.
3) Нашёл файл — останови широкие поиски и работай точечно.

## Лимиты и стоп‑условия
- max файлов в одном поиске: 200; max строк предпросмотра: 300.
- Остановиться, если:
  - найден маяк или точная сигнатура экспорта (`export const registry`, `export function get`, `export abstract class Component`, `createWebHistory('/admin')`, `new Axios` в `http.ts`).
  - найден `document.addEventListener('DOMContentLoaded'...)` в `assets/catalog/catalog.ts` или `createApp(App)` в `assets/admin/admin.ts`.
- Повторные сканы делать только при изменении требований.

## Редактирование
- Вносить маяки только первыми строками файлов.
- Не менять бизнес‑логику.
- Соблюдать политику: FSD для каталога (`@catalog_js_architecture.mdc`), архитектуру админки (`@admin_js_architecture.mdc`), запрет хардкодов (`@hardcoderules.mdc`).

## Связанные правила
- `@ai_context.mdc`
- `@catalog_js_architecture.mdc`
- `@stimulus_policy.mdc`

