---
alwaysApply: true
description: Политика оформления/форматирования Cursor Rules для ИИ агента
globs:
  - ".cursor/rules/**"
---

# Политика создания и форматирования правил (Cursor Rules Authoring Policy)

Последнее обновление: 2025-09-17

## Назначение
- Единые требования к структуре, стилю и связыванию `.mdc` правил в `.cursor/rules/**`.
- Используется ИИ‑агентом при создании/обновлении правил, карт компонентов/страниц и глобальных политик.

## Где размещать файлы
- Каталог: `.cursor/rules/`
- Имена файлов: `snake_case` на английском, коротко и по смыслу:
  - Глобальные политики: `<domain>_policy.mdc` (например, `agent_performance_policy.mdc`)
  - Тематические справочники: `<topic>.mdc` (например, `services.mdc`)
  - Карты компонентов: `component_<kebab>_map.mdc`
  - Карты страниц: `page_<id>_map.mdc`

## Фронт‑маттер (обязателен)
```yaml
---
alwaysApply: <true|false>
---
```
- `alwaysApply: true` — глобальные политики/правила, применимые ко всему проекту.
- `alwaysApply: false` — локальные карты (страниц/компонентов) и контекстные правила, чтобы не раздувать pinned‑набор.

## Структура файла
Порядок разделов (рекомендуемый):
1) Заголовок `# ...`
2) Короткое назначение/область действия
3) «Где размещать/имена» (если уместно)
4) Правила/чек‑листы/ограничения (лаконичные пункты)
5) Примеры (необязательно; минимальные и точные)
6) Связанные правила/ссылки (`@file.mdc`)

Требования к оформлению:
- Язык: русский, технический, лаконичный.
- Маркдаун заголовков: используйте `#`, `##`, `###` (как в существующих правилах). 
- Списки: дефис `- `; короткие пункты, без воды.
- Код/фрагменты: краткие fenced‑блоки, только по делу.
- Ссылки на правила — в виде маркеров `@<file>.mdc` (без bare URL).

## Правила ссылок и индексов
- Глобальные политики должны быть перечислены в разделе «Связанные правила Cursor» файла `@ai_context.mdc`.
- Карты компонентов/страниц:
  - Для компонента: создайте `component_<kebab>_map.mdc` и добавьте запись в `@components_index.mdc`.
  - Для страницы: создайте `page_<id>_map.mdc` и добавьте запись в `@pages_index.mdc`.
- В шаблонах Twig компонентов первая строка — якорь `{# ai:component=<kebab> map=@component_<kebab>_map.mdc v=1 #}`.

## Конфликты и совместимость
- Не дублируйте существующие правила; при пересечении — расширяйте/уточняйте текущие файлы.
- Не меняйте смысл глобальных политик без явной причины; предпочитайте уточняющие разделы.
- При изменениях в `src/Entity/**`/`src/Service/**`/checkout‑флоу — обновляйте соответствующие справочники (`@doctrine_entities.mdc`, `@services.mdc`, `@order_checkout_flow.mdc`) в том же PR.

## Acceptance‑чеклист для нового правила
- Файл в `.cursor/rules/` с корректным именем и фронт‑маттером.
- Разделы: назначение, правила/чек‑лист, ссылки.
- Нет хардкодов противоречащих `@hardcoderules.mdc`.
- Ссылки на смежные правила добавлены (минимум — `@ai_context.mdc` для глобальных политик).
- Для карт компонентов/страниц: добавлены в соответствующие индексы.

## Мини‑шаблоны

Шаблон глобальной политики:
```md
---
alwaysApply: true
---

# <Название политики>

Короткое назначение...

## Правила
- ...

## Связанные правила
- @ai_context.mdc
- @projectrules.mdc
```

Шаблон карты компонента:
```md
---
alwaysApply: false
---

# Component: <kebab>

Назначение: ...

Файлы
- Twig: `templates/components/<...>.html.twig`

Корневой селектор
- `[data-testid="<...>"]`

Стабильные якоря
- ...

Примечания
- ...
```

## Связанные правила
- @ai_context.mdc
- @agent_performance_policy.mdc
- @catalog_js_architecture.mdc
- @twig_components_policy.mdc
- @components_index.mdc
- @pages_index.mdc

