<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .performance { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .stats { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤</h1>

    <div>
        <button onclick="testSingleCopyPerformance()">–¢–µ—Å—Ç –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è</button>
        <button onclick="testBulkCopyPerformance()">–¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è</button>
        <button onclick="testCategoryCachePerformance()">–¢–µ—Å—Ç –∫—ç—à–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</button>
        <button onclick="clearResults()">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>

    <div id="results"></div>

    <script>
        function addResult(title, content, type = 'success') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `<strong>${title}</strong><br>${content}`;
            resultsDiv.appendChild(resultDiv);
        }

        async function measureTime(operation) {
            const start = performance.now();
            const result = await operation();
            const end = performance.now();
            return { result, time: end - start };
        }

        async function testSingleCopyPerformance() {
            addResult('–¢–µ—Å—Ç –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', '–ó–∞–ø—É—Å–∫...', 'performance');

            const { result, time } = await measureTime(async () => {
                // Simulate single copy performance
                const response = await fetch('/api/v2/products?page=1&itemsPerPage=1');
                return response.ok ? '–£—Å–ø–µ—à–Ω–æ' : '–û—à–∏–±–∫–∞';
            });

            addResult('–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è',
                `–í—Ä–µ–º—è: ${time.toFixed(2)}ms<br>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result}`,
                'performance');
        }

        async function testBulkCopyPerformance() {
            addResult('–¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', '–ó–∞–ø—É—Å–∫...', 'performance');

            const { result, time } = await measureTime(async () => {
                // Test parallel requests simulation
                const promises = Array.from({length: 3}, (_, i) =>
                    fetch(`/api/v2/products?page=${i+1}&itemsPerPage=1`)
                );
                const results = await Promise.all(promises);
                return results.every(r => r.ok) ? '–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —É—Å–ø–µ—à–Ω—ã' : '–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ—É–¥–∞—á–Ω—ã';
            });

            addResult('–†–µ–∑—É–ª—å—Ç–∞—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è',
                `–í—Ä–µ–º—è: ${time.toFixed(2)}ms<br>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result}`,
                'performance');
        }

        async function testCategoryCachePerformance() {
            addResult('–¢–µ—Å—Ç –∫—ç—à–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π', '–ó–∞–ø—É—Å–∫...', 'performance');

            const { result, time } = await measureTime(async () => {
                const response = await fetch('/api/v2/categories?page=1&itemsPerPage=10');
                if (response.ok) {
                    const data = await response.json();
                    const categories = data['hydra:member'] || [];
                    return `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${categories.length} –∫–∞—Ç–µ–≥–æ—Ä–∏–π`;
                }
                return '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
            });

            addResult('–†–µ–∑—É–ª—å—Ç–∞—Ç –∫—ç—à–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π',
                `–í—Ä–µ–º—è: ${time.toFixed(2)}ms<br>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result}`,
                'performance');
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // Show performance tips
        window.addEventListener('load', () => {
            setTimeout(() => {
                addResult('üí° –°–æ–≤–µ—Ç—ã –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏',
                    `<ul>
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ–ø–µ—Ä–∞—Ü–∏–π</li>
                        <li>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (Promise.all)</li>
                        <li>–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–µ–π –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏</li>
                        <li>–û—Ç–∫–ª—é—á–∞–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ</li>
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö</li>
                    </ul>`,
                    'performance');
            }, 1000);
        });
    </script>
</body>
</html>
